# Network Forensics Analysis for dummies

## Introduction to Network Forensics

Network forensics is the process of capturing, recording, and analyzing network traffic to detect intrusions, investigate security incidents, and understand network behavior.

### Why Network Forensics?
- Detect security breaches and intrusions
- Investigate suspicious network activity
- Troubleshoot network performance issues
- Gather evidence for legal proceedings
- Understand application behavior
- Monitor network compliance

### Key Concepts
- **Packets**: Small units of data transmitted over a network
- **Protocols**: Rules that govern how data is transmitted (TCP, UDP, HTTP, DNS, etc.)
- **Headers**: Metadata attached to packets containing source, destination, and other information
- **Payload**: The actual data being transmitted

---

## Understanding Packets

### What is a Packet?

A **packet** is a small piece of data sent over a network. Think of it like sending a letter:
- The **envelope** has the address (headers)
- The **letter inside** is your message (data/payload)
- The **postal rules** determine how it's delivered (protocols)

When you browse a website or send an email, your data is broken into small packets that travel independently across the network and are reassembled at the destination.

### Anatomy of a Packet

A packet has multiple layers, like nested envelopes. Each layer adds information:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Application Data (HTTP, DNS)    â”‚  â† Your actual data
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Transport Header (TCP/UDP)        â”‚  â† Port numbers
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Network Header (IP)               â”‚  â† IP addresses
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Data Link Header (Ethernet)       â”‚  â† MAC addresses
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### The 4 Key Layers You'll See in Wireshark

**1. Ethernet (Data Link Layer)**
- **What**: Handles local network delivery
- **Contains**: MAC addresses (physical hardware addresses)
- **Example**: `aa:bb:cc:dd:ee:ff â†’ 11:22:33:44:55:66`

**2. IP (Network Layer)**
- **What**: Routes packets across the internet
- **Contains**: Source and destination IP addresses, TTL (time to live)
- **Example**: `192.168.1.100 â†’ 8.8.8.8`

**3. TCP or UDP (Transport Layer)**
- **What**: Manages how data is sent between applications
- **Contains**: Port numbers, connection flags
- **Example**: `Port 54321 â†’ Port 80` (your computer to web server)

**4. Application Layer (HTTP, DNS, FTP, etc.)**
- **What**: The actual data being transmitted
- **Example**: `GET /index.html HTTP/1.1` or DNS query for "google.com"

### Important Fields for Forensics

| Field | What It Is | Why It Matters |
|-------|------------|----------------|
| **IP Address** | Network address (e.g., 192.168.1.1) | Identifies who sent/received data |
| **MAC Address** | Physical device address | Identifies specific hardware on local network |
| **Port Number** | Application identifier (e.g., 80=HTTP) | Shows which service was used |
| **TCP Flags** | Connection state (SYN, ACK, FIN) | Shows connection setup/teardown |
| **Payload** | The actual data | Contains the information being sent |

---

## How Packets Are Transmitted

### Simple Example: Visiting a Website

When you type `www.example.com` in your browser:

**Step 1: Find the IP Address (DNS)**
```
You: "What's the IP for www.example.com?"
DNS Server: "It's 93.184.216.34"
```

**Step 2: Establish Connection (TCP 3-Way Handshake)**
```
You â†’ Server: [SYN] "Can I connect?"
Server â†’ You: [SYN-ACK] "Yes, let's connect"
You â†’ Server: [ACK] "Great, I'm ready"
```

**Step 3: Request the Page**
```
You â†’ Server: "GET /index.html"
```

**Step 4: Receive the Response**
```
Server â†’ You: "Here's the HTML..."
```

**Step 5: Close Connection**
```
You â†’ Server: [FIN] "I'm done"
Server â†’ You: [FIN-ACK] "Me too, goodbye"
```
### what's a three way handshake : 
<img width="924" height="255" alt="image" src="https://github.com/user-attachments/assets/d405722b-2b4a-41dd-bdaa-98c04f3a0cb1" />   
<img width="924" height="255" alt="image" src="https://github.com/user-attachments/assets/f1485dc3-f099-4c56-a4cf-ae2cdc8977fe" />
<img width="926" height="279" alt="image" src="https://github.com/user-attachments/assets/a4666609-fe45-4ebc-8e3f-8938eca483b4" /> 


### TCP vs UDP: Two Ways to Send Data

**TCP (Transmission Control Protocol)**
- Reliable - guarantees delivery
- Ordered - packets arrive in sequence
- Slower - more overhead
- Used for: Web browsing, email, file downloads

**UDP (User Datagram Protocol)**
- Fast - minimal overhead
- No guarantees - packets may be lost
- Used for: Streaming, gaming, voice calls, DNS

---

## Network Protocol Reference

Here are the most common protocols you'll encounter in network forensics:

### Essential Protocols Table

| Protocol | Port | Purpose | Security Level |
|----------|------|---------|----------------|
| **HTTP** | 80 | Web browsing | âš ï¸ Unencrypted - data visible |
| **HTTPS** | 443 | Secure web browsing | âœ… Encrypted with TLS/SSL |
| **DNS** | 53 | Converts domain names to IPs | âš ï¸ Unencrypted - queries visible |
| **FTP** | 20, 21 | File transfer | âš ï¸ Credentials in cleartext |
| **SSH** | 22 | Secure remote access | âœ… Encrypted |
| **Telnet** | 23 | Remote access | ğŸ”´ Never use - completely insecure |
| **SMTP** | 25, 587 | Sending email | âš ï¸ Often unencrypted |
| **POP3** | 110 | Retrieving email | âš ï¸ Often unencrypted |
| **IMAP** | 143 | Retrieving email | âš ï¸ Often unencrypted |
| **DHCP** | 67, 68 | Assigns IP addresses | âš ï¸ Can be spoofed |
| **RDP** | 3389 | Windows remote desktop | âš ï¸ Often targeted by attackers |
| **SMB** | 445 | Windows file sharing | âš ï¸ Common ransomware target |
| **ICMP** | N/A | Ping, error messages | âš ï¸ Can be used for tunneling |

### Application Layer Protocols (Layer 7)
These handle the actual data you're sending:
- Web browsing: HTTP, HTTPS
- Email: SMTP, POP3, IMAP
- File transfer: FTP, SFTP, SMB
- Remote access: SSH, RDP, Telnet

### Transport Layer Protocols (Layer 4)
These manage how data is sent:
- **TCP**: Reliable, ordered (web, email, file downloads)
- **UDP**: Fast, no guarantees (streaming, gaming, DNS)

### Network Layer Protocols (Layer 3)
These handle routing:
- **IP**: Internet Protocol (addresses packets)
- **ICMP**: Error messages and ping

### Port Quick Reference

**Common Web Ports:**
- 80 = HTTP
- 443 = HTTPS
- 8080 = Alternative HTTP

**Common Email Ports:**
- 25, 587 = SMTP (sending)
- 110 = POP3 (receiving)
- 143 = IMAP (receiving)

**Common File Transfer:**
- 20, 21 = FTP
- 22 = SSH/SFTP
- 445 = SMB (Windows shares)

**Common Remote Access:**
- 22 = SSH
- 23 = Telnet
- 3389 = RDP (Remote Desktop)

**Other Important:**
- 53 = DNS
- 67, 68 = DHCP

---

## What is Wireshark?

Wireshark is a free, open-source network protocol analyzer that allows you to capture and interactively browse network traffic.

### Key Features
- Live packet capture from network interfaces
- Deep inspection of hundreds of protocols
- Rich filtering language
- Export capabilities to various formats
- Cross-platform support (Windows, macOS, Linux)
- Powerful analysis and statistics tools

### Installation
- **Windows/macOS**: Download from [wireshark.org](https://www.wireshark.org)
- **Linux**: `sudo apt install wireshark` (Ubuntu/Debian) or `sudo yum install wireshark` (CentOS/RHEL)

---

## Getting Started

### Launching Your First Capture

1. Open Wireshark
2. Select a network interface (Ethernet, Wi-Fi, etc.)
3. Click the blue shark fin icon to start capturing
4. Generate some traffic (browse a website, ping a server)
5. Click the red square icon to stop capturing

### Saving Captures
- File â†’ Save As
- Use `.pcap` or `.pcapng` format
- `.pcapng` is preferred (supports more features)

---

## Understanding the Interface

Wireshark's interface consists of three main panels:

### 1. Packet List Pane (Top)
Shows a summary of each captured packet with columns:
- **No.**: Packet number in the capture
- **Time**: Timestamp of packet capture
- **Source**: Source IP address
- **Destination**: Destination IP address
- **Protocol**: Network protocol used
- **Length**: Packet size in bytes
- **Info**: Brief description of the packet content

### 2. Packet Details Pane (Middle)
Hierarchical view of the selected packet's protocols and fields:
- Frame (physical layer)
- Ethernet II (data link layer)
- Internet Protocol (network layer)
- TCP/UDP (transport layer)
- Application layer (HTTP, DNS, etc.)

### 3. Packet Bytes Pane (Bottom)
Raw hexadecimal and ASCII representation of the packet data.

---

## Capture Filters vs Display Filters

### Capture Filters
Applied **before** packets are captured. Uses BPF (Berkeley Packet Filter) syntax.

**Common Examples:**
```
host 192.168.1.1          # Capture traffic to/from specific host
port 80                   # Capture HTTP traffic
tcp port 443              # Capture HTTPS traffic
net 192.168.1.0/24        # Capture traffic from specific subnet
not broadcast and not multicast  # Exclude broadcast/multicast
```

### Display Filters
Applied **after** packets are captured. More powerful and flexible.

**Common Examples:**
```
ip.addr == 192.168.1.1    # Show packets to/from specific IP
tcp.port == 80            # Show HTTP traffic
http.request.method == "GET"  # Show HTTP GET requests
dns.qry.name contains "google"  # Show DNS queries containing "google"
tcp.flags.syn == 1 and tcp.flags.ack == 0  # Show TCP SYN packets
ip.src == 192.168.1.1 and ip.dst == 8.8.8.8  # Specific source and destination
```

### Filter Operators
- `==` (equal), `!=` (not equal)
- `>`, `<`, `>=`, `<=` (comparison)
- `and`, `or`, `not` (logical operators)
- `contains`, `matches` (string operations)

---

## Basic Packet Analysis

### TCP Three-Way Handshake

Understanding connection establishment:

1. **SYN**: Client sends synchronization request
2. **SYN-ACK**: Server acknowledges and responds
3. **ACK**: Client acknowledges server's response

**Filter to see handshake:**
```
tcp.flags.syn == 1 or tcp.flags.fin == 1
```

### Analyzing HTTP Traffic

**Filter for HTTP:**
```
http
```

**Steps to analyze:**
1. Find HTTP request (GET, POST, etc.)
2. Look at request headers (User-Agent, Host, etc.)
3. Find corresponding response
4. Check response code (200, 404, 500, etc.)
5. Extract objects: File â†’ Export Objects â†’ HTTP

### Following TCP Streams

Right-click on any TCP packet â†’ Follow â†’ TCP Stream

This reconstructs the entire conversation between client and server, making it easy to read application-layer data.

---

## Common Protocols

### HTTP (Port 80)
- Unencrypted web traffic
- Easy to read requests and responses
- Look for sensitive data in cleartext

### HTTPS (Port 443)
- Encrypted web traffic (TLS/SSL)
- Can see connection establishment but not content
- Look at certificate information

### DNS (Port 53)
- Domain name resolution
- Check for unusual domains or DNS tunneling
- Filter: `dns`

### FTP (Port 21)
- File transfer protocol
- Credentials sent in cleartext
- Filter: `ftp`

### SSH (Port 22)
- Encrypted remote access
- Can see connection but not content
- Filter: `ssh`

### SMTP (Port 25, 587)
- Email transmission
- Can see email headers and content if unencrypted
- Filter: `smtp`

---

## Practical Exercises

### Exercise 1: Identify Your IP Address
1. Start a capture
2. Visit a website
3. Apply filter: `http.request`
4. Look at the Source IP in the packet list
5. This is your machine's IP address

### Exercise 2: Find HTTP Credentials
1. Start a capture
2. Visit a test website with login (use a test account!)
3. Stop capture
4. Apply filter: `http.request.method == POST`
5. Follow TCP stream of the POST request
6. Look for username/password in cleartext

### Exercise 3: DNS Query Analysis
1. Start a capture
2. Visit several websites
3. Apply filter: `dns`
4. Examine DNS queries and responses
5. Note the query names and IP addresses returned

### Exercise 4: Detect Port Scan
1. Use nmap to scan a test machine: `nmap -sS [target-ip]`
2. Capture the traffic
3. Apply filter: `tcp.flags.syn == 1 and tcp.flags.ack == 0`
4. Notice multiple SYN packets to different ports from same source

### Exercise 5: Extract Files from HTTP
1. Capture traffic while downloading a file via HTTP
2. Go to File â†’ Export Objects â†’ HTTP
3. Find and save the file
4. Verify it's the same file you downloaded

---

## Investigation Scenarios

### Scenario 1: Unauthorized Access Investigation

**Objective**: Identify if unauthorized access occurred

**Steps:**
1. Filter for authentication protocols: `http.authorization or ftp or telnet or ssh`
2. Look for failed login attempts: `http.response.code == 401`
3. Check for successful access after failures
4. Identify source IP of attacker
5. Create timeline of events

**Red Flags:**
- Multiple failed authentication attempts
- Access from unusual IP addresses or countries
- Access at unusual times
- Privilege escalation attempts

### Scenario 2: Data Exfiltration

**Objective**: Detect if sensitive data was stolen

**Steps:**
1. Filter for large outbound transfers: `tcp.len > 1000 and ip.dst != 192.168.0.0/16`
2. Look for unusual protocols or ports
3. Check DNS queries for suspicious domains
4. Examine HTTP POST requests for data uploads
5. Analyze FTP or other file transfer traffic

**Red Flags:**
- Large data transfers to external IPs
- Use of file-sharing services
- Encrypted channels to unknown servers
- DNS tunneling attempts
- Traffic to known malicious IPs

### Scenario 3: Malware Communication

**Objective**: Identify malware command and control (C2) traffic

**Steps:**
1. Look for beaconing behavior (regular intervals)
2. Filter for unusual domains: `dns`
3. Check for connections to uncommon ports
4. Analyze HTTP User-Agent strings for anomalies
5. Look for Base64 encoded data in HTTP requests

**Red Flags:**
- Periodic connections at fixed intervals
- Connections to recently registered domains
- Strange User-Agent strings
- Traffic to IP addresses instead of domains
- Unusual protocol on common ports

---

## Best Practices

### Capture Best Practices

1. **Use appropriate capture filters** to reduce file size
2. **Capture from the right location** in the network
3. **Use adequate storage** for long-term captures
4. **Timestamp accuracy** is crucial for investigations
5. **Document your process** and findings
6. **Maintain chain of custody** for legal cases

### Analysis Best Practices

1. **Start with statistics**: Protocol Hierarchy, Conversations, Endpoints
2. **Use display filters** to narrow down traffic
3. **Follow streams** for context
4. **Look for anomalies**: unusual ports, protocols, packet sizes
5. **Correlate with logs** from other sources
6. **Export relevant packets** for reporting
7. **Create profiles** for different analysis tasks

 ## **Only capture traffic you're authorized to monitor** !!!!!!!! (matbasiwnash 5awti)


## Useful Display Filters Cheatsheet

### IP Filters
```
ip.addr == 10.0.0.1           # Traffic to or from IP
ip.src == 10.0.0.1            # Traffic from IP
ip.dst == 10.0.0.1            # Traffic to IP
ip.addr == 10.0.0.0/24        # Subnet traffic
```

### TCP Filters
```
tcp.port == 80                # TCP port 80 (HTTP)
tcp.flags.syn == 1            # SYN packets
tcp.flags.reset == 1          # RST packets
tcp.analysis.retransmission   # Retransmitted packets
tcp.window_size_value < 8192  # Small window sizes
```

### HTTP Filters
```
http.request                  # HTTP requests
http.response.code == 200     # Successful responses
http.request.method == "POST" # POST requests
http.host contains "google"   # Requests to hosts with "google"
```

### DNS Filters
```
dns.qry.name == "example.com" # DNS query for specific domain
dns.flags.rcode != 0          # DNS errors
dns.qry.type == 1             # A record queries
```

### Suspicious Activity Filters
```
http.request.method == "POST" and tcp.port != 80 and tcp.port != 443
# POST to non-standard ports

dns.qry.name matches "\\.exe$"
# DNS queries ending in .exe

tcp.flags.syn == 1 and tcp.flags.ack == 0 and tcp.window_size < 1024
# Possible SYN scan

icmp.type == 8                # ICMP echo requests (ping)
```

---

## Statistics and Tools

### Useful Statistics

**Protocol Hierarchy**: Statistics â†’ Protocol Hierarchy
- Shows distribution of protocols in capture

**Conversations**: Statistics â†’ Conversations
- Shows all conversations between endpoints
- Useful for identifying top talkers

**Endpoints**: Statistics â†’ Endpoints
- Lists all IP addresses in capture with traffic stats

**IO Graphs**: Statistics â†’ IO Graph
- Visual representation of traffic over time
- Useful for identifying spikes or patterns

### Export Options

- **Export Specified Packets**: File â†’ Export Specified Packets
- **Export Objects**: File â†’ Export Objects â†’ HTTP/DICOM/SMB/etc.
- **Export Packet Dissections**: File â†’ Export Packet Dissections (CSV, JSON, etc.)

---

## Resources

### Official Documentation
- [Wireshark User Guide](https://www.wireshark.org/docs/wsug_html_chunked/)
- [Wireshark Wiki](https://wiki.wireshark.org/)
- [Display Filter Reference](https://www.wireshark.org/docs/dfref/)

### Practice Captures
- [Wireshark Sample Captures](https://wiki.wireshark.org/SampleCaptures)
- [Malware Traffic Analysis](https://www.malware-traffic-analysis.net/)
- [PacketLife Captures](http://packetlife.net/captures/)

### Learning Resources
- [Wireshark Official Tutorial](https://www.wireshark.org/docs/)
- YouTube channels with Wireshark tutorials
- Practice with CTF challenges involving packet analysis

### Tools That Complement Wireshark
- **tcpdump**: Command-line packet analyzer
- **NetworkMiner**: Network forensics tool
- **scapy** : python package to interract with pcaps
- **tshark** : cli version of wireshark


## Conclusion

Network forensics with Wireshark is a valuable skill for security professionals, network administrators, and anyone interested in understanding network behavior. Practice regularly with different scenarios to build your expertise.


